<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="dm">
	<select id="selectMyDm" parameterType="map" resultType="dm">
		select
			dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType,
			reply
		from direct_msg
		where receiver = #{adminId}
	</select>
	 <!-- 1:1 문의 총 카운트  -->
	 <select id="dmCount" parameterType="g" resultType="int">
	 	SELECT COUNT(*) FROM direct_msg where sender !=#{adminId}
	 </select>
	 <!-- 답변대기 카운트 -->
	 <select id="dmReadCount" parameterType="g" resultType="int">
	 	select count(*) from direct_msg where read_check=0 and sender !=#{adminId}
	 </select>
	 <!-- 답변완료 카운트 -->
	 <select id="dmCheckRead" resultType="int">
	 	select count(*) from direct_msg where read_check=1
	 </select>
	 <!-- 1:1 문의 답장하기 -->
	 <insert id="insertDm" parameterType="dm">
	 	insert into direct_msg values
	 	(dm_seq.nextval,#{sender},#{senderCategory},#{receiver},#{dmContent},sysdate,0,#{dmType},#{reply})
	 </insert>
	 <update id="updateReadCheck" parameterType="int">
	 	update direct_msg set read_check=1 where dm_no=#{_parameter}
	 </update>
	 
	 <!-- 유저 1:1문의내역 조회 -->
	 <select id="selectMemberReceiveDm" parameterType="string" resultType="dm">
	 	select
	 		dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType
	 	from direct_msg
	 	where receiver = #{_parameter}
	 	order by 1 desc
	 </select> 
	 <select id="selectMemberSendDm" parameterType="string" resultType="dm">
	 	select
	 		dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType
	 	from direct_msg
	 	where sender = #{_parameter}
	 	order by 1 desc
	 </select>
	 
	 <!-- 유저 받은메시지 읽음 체크 -->
	 <update id="updateMemberReadCheck" parameterType="_int">
	 	update direct_msg
	 	set read_check = 1
	 	where dm_no = #{_parameter}
	 </update>
	 
	 <!-- 파트너 정보 불러오기 -->
	 <select id="selectDmPartner" parameterType="string" resultType="p">
	 	select
			p_no as pNo,
			category,
			p_id as pId,
			p_pw as pPw,
			p_name as pName,
			p_dob as pDob,
			p_phone as pPhone,
			p_gender as pGender,
			p_email as pEmail,
			p_addr as pAddr,
			p_grade as pGrade,
			p_point as pPoint,
			profile_name as profileName,
			profile_path as profilePath,
			apply_motiv as applyMotiv,
			apply_date as applyDate,
			approve_date as approveDate,
			license,
			work_exp as workExp
		from partner
		where p_id = #{_parameter}
	 </select>
	 
	 <delete id="deleteDm" parameterType="_int">
	 	delete from direct_msg where dm_no=#{_parameter}
	 </delete>
</mapper>
