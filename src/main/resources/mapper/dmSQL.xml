<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="dm">
	<select id="selectMyDm" parameterType="map" resultType="dm">
		select
			dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType,
			reply
		from direct_msg
		where receiver = #{adminId}
	</select>
	 <!-- 1:1 문의 총 카운트  -->
	 <select id="dmCount" parameterType="g" resultType="int">
	 	SELECT COUNT(*) FROM direct_msg where sender !=#{adminId}
	 </select>
	 <!-- 답변대기 카운트 -->
	 <select id="dmReadCount" parameterType="g" resultType="int">
	 	select count(*) from direct_msg where read_check=0 and sender !=#{adminId}
	 </select>
	 <!-- 답변완료 카운트 -->
	 <select id="dmCheckRead" resultType="int">
	 	select count(*) from direct_msg where read_check=1
	 </select>
	 <!-- 1:1 문의 답장하기 -->
	 <insert id="insertDm" parameterType="dm">
	 	insert into direct_msg values
	 	(dm_seq.nextval,#{sender},#{senderCategory},#{receiver},#{dmContent},sysdate,0,#{dmType},#{reply})
	 </insert>
	 <!-- 1:1 답변대기 -->
	 <update id="updateReadCheck" parameterType="int">
	 	update direct_msg set read_check=1 where dm_no=#{_parameter}
	 </update>
	 <!-- 답변보여주기 -->
	 <select id="dmContent" parameterType="int" resultType="dm">
	 	select
			dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType,
			reply
		from direct_msg where reply= #{_parameter}
	 </select>
	 <!-- 관리자P 검색 (취소/결제)  -->
	 <select id="selectdmType" parameterType="map" resultType="dm">
	 	select
			dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType,
            reply
		from direct_msg 
		where sender like '%'||#{keyword}||'%'
		and dm_type = #{dmType} and sender != 'admin'
	 </select>
	 
	  <!-- 유저 1:1문의내역 조회 -->
	 <select id="selectMemberReceiveDm" parameterType="string" resultType="dm">
	 	select
	 		dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType
	 	from direct_msg
	 	where receiver = #{_parameter}
	 </select>
	 
	 <select id="selectMemberSendDm" parameterType="string" resultType="dm">
	 	select
	 		dm_no as dmNo,
			sender,
			sender_category as senderCategory,
			receiver,
			dm_content as dmContent,
			dm_date as dmDate,
			read_check as readCheck,
			dm_type as dmType
	 	from direct_msg
	 	where sender = #{_parameter}
	 </select>
</mapper>
